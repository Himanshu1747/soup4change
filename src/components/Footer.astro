---
import HeaderLink from "./HeaderLink.astro";
import { queryWordPress } from "../lib/wordpress";
import Poppup from "./Poppup.astro";
const FOOTER_DATA = `
query GetAllWidgetData {
  footerBuilderWidget1 {
    type
    title
    content
    image_url
    image_alt
  }
}
`;

const footerRes = await queryWordPress(FOOTER_DATA);
const widgets = footerRes?.footerBuilderWidget1 ?? [];
let bgImage, logo, contactInfo, copyright;
for (const w of widgets) {
  if (w.title === "footer-image") bgImage = w;
  else if (w.title === "footer-logo") logo = w;
  else if (w.type === "custom_html") contactInfo = w;
  else if (w.title === "copyright") copyright = w;
}
const QUERY_MENU = `
query MainMenu {
  menu(id: "mainmenu", idType: SLUG) {
    menuItems {
      nodes {
        label
        uri
        target
        childItems {
          nodes {
            id
          }
        }
      }
    }
  }
}
`;

const menuRes = await queryWordPress(QUERY_MENU);
const menuItems = menuRes?.menu?.menuItems?.nodes ?? [];
---


<footer class="custom-footer">
  <div class="main-footer">
    {bgImage && (
      <img
        src={bgImage.image_url}
        alt={bgImage.image_alt || "footer background"}
        class="overlay-imagefooter"
        width="1920"
        height="414"
        loading="lazy"
      />
    )}

    <div class="container">
      {logo && (
        <div class="footer-logo">
          <img
            src={logo.image_url}
            alt={logo.image_alt || "Soup4change"}
            width="367"
            height="208"
            loading="lazy"
          />
        </div>
      )}

      <ul class="footer-list">
        {menuItems.map((item) => {
          const hasChildren = item.childItems?.nodes?.length > 0;

          return (
            <li class={hasChildren ? "menu-item-has-children" : ""}>
              <HeaderLink
                href={item.uri.replace(/\/$/, "")}
                title={item.label}
                target={item.target}
              >
                {item.label}
              </HeaderLink>
            </li>
          );
        })}
      </ul>

      {contactInfo && (
        <div
          class="contact-details-wrapper"
          set:html={contactInfo.content}
        />
      )}
    </div>
  </div>

  <div class="copayrights">
    <div class="container">
      {copyright && (
        <p set:html={copyright.content} />
      )}
    </div>
  </div>
</footer>

<Poppup/>


<style>
    .main-footer {
        position: relative;
        z-index: 1;
        color: var(--color-white);
        padding: 25px 0px;
    }

    .footer-logo {
        max-width: 365px;
        width: 100%;
        margin: 0 auto 15px;
    }

    ul.footer-list li a,
    .contact-emails p {
        font-size: var(--fs-20);
        font-style: normal;
        font-weight: 500;
        line-height: normal;
    }

    ul.footer-list {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
        gap: 30px;
        border-top: 1px solid var(--color-white);
        border-bottom: 1px solid var(--color-white);
        max-width: 1100px;
        width: 100%;
        margin: 0 auto;
        padding: 15px 20px;
    }

    .overlay-imagefooter {
        position: absolute;
        inset: 0;
        height: 100%;
        width: 100%;
        object-fit: cover;
        object-position: center;
        filter: brightness(0.3);
        z-index: -1;
    }

    ul.footer-list li a:hover {
        color: var(--color-red);
    }

    .contact-emails {
        max-width: fit-content;
        width: 100%;
        text-align: center;
    }

    img.detsil-icon {
        max-width: 30px;
        width: 100%;
        margin: 0 auto 15px;
    }

     .copayrights {
        padding: 5px 0px;
        text-align: center;
    }

   .copayrights p{
        font-size: var(--fs-20);
        font-style: normal;
        font-weight: 400;
        line-height: normal;
        padding: 0;
    }

    .copayrights p a:hover {
        color: var(--color-red);
    }

    @media (max-width: 1600px) {
        .footer-logo {
            max-width: 280px;
        }
    }
    @media (max-width: 1400px) {
        .footer-logo {
            max-width: 250px;
        }

        ul.footer-list {
            gap: 15px;
        }

        .contact-details {
            gap: 20px;
        }
    }
</style>
