---
import { queryWordPress } from "../lib/wordpress";
import BaseHead from "../components/BaseHead.astro";
import Contactform from "../components/Contactform.astro";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";

const ENDORSEMENT_QUERY = `
query endorsements {
  page(id: "endorsements", idType: URI) {
    title
    seo {
      fullHead
    }
    featuredImage {
      node {
        sourceUrl
        mediaItemUrl
        altText
      }
    }
    endorsementspage {
      logoHere {
        logoImage {
          node {
            sourceUrl
            mediaItemUrl
            altText
          }
        }
        logoLinks {
          url
          title
          target
        }
      }
    }
  }
}
`;

const pagedata = await queryWordPress(ENDORSEMENT_QUERY);
const finaldata = pagedata?.page;

// Performance: Extract the Hero Image URL
// Note: prioritize mediaItemUrl, fallback to sourceUrl
const heroImage =
    finaldata?.featuredImage?.node?.mediaItemUrl ||
    finaldata?.featuredImage?.node?.sourceUrl;
const heroAlt =
    finaldata?.featuredImage?.node?.altText || "Endorsements Banner";

// Correcting your data mapping for the logos
const endorsementsLogos = finaldata?.endorsementspage?.logoHere || [];
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead useYoast={true} />
        {
            finaldata?.seo?.fullHead && (
                <Fragment set:html={finaldata.seo.fullHead} />
            )
        }

        {
            heroImage && (
                /* High Priority Preload for LCP */
                <link
                    rel="preload"
                    as="image"
                    href={heroImage}
                    fetchpriority="high"
                />
            )
        }
    </head>

    <body>
        <Header />

        <section class="innserbanner-sec">
            {
                heroImage && (
                    <img
                        src={heroImage}
                        alt={heroAlt}
                        width="1920"
                        height="707"
                        class="innerbanner-image"
                        loading="eager"
                        fetchpriority="high"
                        decoding="sync"
                    />
                )
            }
        </section>

        <section class="greenusa-section">
            <div class="container">
                <div class="gridlogoendorsmnts">
                    {/* Mapping through your dynamic WordPress data */}
                    {
                        endorsementsLogos.map((item) => (
                            <div class="greenusa-holders">
                                <a
                                    href={item.logoLinks?.url || "#"}
                                    target={item.logoLinks?.target || "_self"}
                                >
                                    <img
                                        src={item.logoImage?.node?.sourceUrl}
                                        alt={
                                            item.logoImage?.node?.altText ||
                                            "Partner Logo"
                                        }
                                        loading="lazy"
                                    />
                                </a>
                            </div>
                        ))
                    }

                </div>
            </div>
        </section>

        <div class="blue-form">
            <Contactform />
        </div>

        <Footer />

        <style>
            .greenusa-section {
                padding: 40px 0px;
            }
            .greenusa-holders {
                max-width: 400px;
                width: 100%;
            }
            .gridlogoendorsmnts {
                display: flex;
                align-items: center;
                flex-wrap: wrap;
                justify-content: center;
                flex-direction: row-reverse;
                gap: 40px;
            }
            @media (max-width: 1199px) {
                .greenusa-section {
                    padding: 30px 0px;
                }
            }
            @media (max-width: 575px) {
                .gridlogoendorsmnts {
                    flex-direction: column;
                    gap: 30px;
                }
            }
        </style>
        <style>
            .centerdata-shelbyy {
                max-width: 895px;
                width: 100%;
                margin: 0 auto;
                text-align: center;
            }
            .centerdata-shelbyy .fs-60,
            .hey-everyone .fs-60 {
                padding-bottom: 20px;
            }

            .hey-everyone {
                max-width: 92%;
                width: 100%;
            }
            .hey-everyone p {
                font-size: var(--fs-20);
                font-style: normal;
                font-weight: 500;
                line-height: normal;
            }

            .hey-everyone .universal-anchor {
                padding-top: 50px;
            }

            .image-view img {
                max-width: fit-content;
                position: relative;
                border-radius: 20px;
                overflow: hidden;
            }

            .image-view {
                max-width: 775px;
                width: 100%;
                /* background: red; */
                display: flex;
                position: relative;
                z-index: 1;
            }
            .image-view .second-image {
                margin-top: 7%;
                z-index: -11;
                transform: translateX(-6%);
            }

            .image-view img.first-image {
                z-index: -1;
                height: fit-content;
            }

            section.howshelbygotthis-sec {
                padding: 60px 0px;
            }

            .centerdata-shelbyy {
                padding-bottom: 135px;
            }

            section.education-sec {
                padding: 50px 0px;
                background: rgba(63, 44, 188, 0.1);
            }
            .highscholl-holders {
                max-width: 305px;
                width: 100%;
                min-height: 368px;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 30px;
                border-radius: 30px;
                background: var(--color-yellow);
                color: var(--color-white);
                text-align: center;
            }

            .highscholl-holders .fs-30 {
                font-weight: 500;
                padding-bottom: 15px;
            }

            img.education-icon {
                max-width: 48px;
                width: 100%;
                margin: 0 auto 35px;
            }

            .highscholl-holders p {
                font-size: var(--fs-20);
                font-weight: 500;
            }

            .grid-education {
                display: grid;
                gap: 50px;
                grid-template-columns: repeat(4, minmax(0, 1fr));
                max-width: fit-content;
                margin: 0 auto;
                width: 100%;
            }

            .center-eductaion {
                max-width: fit-content;
                margin: 0 auto;
                width: 100%;
                padding-bottom: 75px;
            }

            .grid-education .highscholl-holders:nth-child(2) {
                background: #8a38f5;
            }
            .grid-education .highscholl-holders:nth-child(3) {
                background: #d51d75;
            }
            .grid-education .highscholl-holders:nth-child(4) {
                background: #1e1e1e;
            }

            .editing-image {
                max-width: fit-content;
                margin: 0 auto;
                border-radius: 20px;
                overflow: hidden;
                width: 100%;
            }

            .gridbuttonss {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                padding-top: 30px;
            }

            .gridbuttonss .universal-anchor {
                max-width: 253px;
                width: 100%;
                display: block;
            }

            .gridbuttonss .universal-anchor a {
                width: 100%;
                max-width: 100%;
            }

            .editing-details .fs-60 {
                padding-bottom: 20px;
            }

            .editing-details p {
                color: var(--color-blue) !important;
            }

            section.stillediting-sec {
                padding: 85px 0px;
            }

            @media (max-width: 1600px) {
                .centerdata-shelbyy {
                    padding-bottom: 70px;
                }
                .highscholl-holders {
                    min-height: auto;
                    padding: 30px 20px;
                }

                .center-eductaion {
                    padding-bottom: 50px;
                }

                section.stillediting-sec {
                    padding: 60px 0px;
                }
            }

            @media (max-width: 1400px) {
                .centerdata-shelbyy {
                    padding-bottom: 40px;
                }

                section.howshelbygotthis-sec {
                    padding: 40px 0px;
                }

                .hey-everyone .universal-anchor {
                    padding-top: 20px;
                }

                .editing-image {
                    max-width: 300px;
                }

                section.education-sec,
                section.stillediting-sec {
                    padding: 40px 0px;
                }
            }

            @media (max-width: 1199px) {
                .grid-education {
                    gap: 30px;
                }

                .center-eductaion {
                    padding-bottom: 30px;
                }
            }

            @media (max-width: 991px) {
                .hey-everyone {
                    max-width: 100%;
                    padding-bottom: 30px;
                }

                .centerdata-shelbyy {
                    padding-bottom: 30px;
                }

                .centerdata-shelbyy .fs-60,
                .hey-everyone .fs-60 {
                    padding-bottom: 15px;
                }

                .grid-education {
                    grid-template-columns: repeat(2, minmax(0, 1fr));
                }

                .editing-details {
                    padding-top: 30px;
                    text-align: center;
                }
                .gridbuttonss {
                    justify-content: center;
                }
            }
            @media (max-width: 767px) {
                .centerdata-shelbyy {
                    padding-bottom: 20px;
                }

                img.education-icon {
                    margin: 0 auto 15px;
                }
            }

            @media (max-width: 575px) {
                .grid-education {
                    grid-template-columns: repeat(1, minmax(0, 1fr));
                }
            }
        </style>
    </body>
</html>
